# CardioVR - гайд по разработке
Эта короткая памятка поможет сразу сообразить, что к чему.

**Важно!** Гайд будет обновляться в следующих условиях:
- Ожидается новый участник проекта
- Один из участников уехал на долгикий срок, и ему нужно быстро войти в курс дела
## Квесты
### Quest как совокупность компонентов
Чтобы соответствовать SRP, BaseQuest был поделен на несколько компонентов:
- **QuestCore**. Имеет базовую информацию о квесте, через него можно вызвать другие компоненты
- **QuestNarratorController**. Проигрывает фразы из скриптабла в нарратор
- **QuestStateController**. Отвечает за состояние игры. Имеет события OnCompleted и OnStarted. На них подписываются прочие объекты.
- **QuestVisualController**. Собирает визуальные аниматоры с "потомков", а после включает или выключает их.
  - Есть настройка для сокрытия некоторых объектов с определенным тэгом, когда игра началась  <img width="521" height="249" alt="image" src="https://github.com/user-attachments/assets/92e1a329-270f-460c-affc-960621b04739" />
- **QuestLogic**. Имплементируемый компонент квеста. Для каждого он свой. Внутри происходит вся нужная логика игры. Поскольку это "деталь" в сравнении с прочими классами, здесь можно прям говнокодить (только не сильно). Далее будут примеры разных логик:
  <img width="517" height="405" alt="image" src="https://github.com/user-attachments/assets/433c35d4-23a6-4e9b-a7ee-2a83e9af2201" /><img width="531" height="59" alt="image" src="https://github.com/user-attachments/assets/5f54cc99-6b7e-42d0-98a8-b385ebaff08b" /><img width="519" height="271" alt="image" src="https://github.com/user-attachments/assets/937c450b-1696-4c1b-82a4-da319c1f3cab" />
- **QuestPhasable**. Фазы квеста.
  - На каждую фазу можно накинуть действия через инспектор. Лучше всего писать действия в логике. Нюанс: чтобы инспектор их увидел, действия должны быть публичные. <img width="517" height="567" alt="image" src="https://github.com/user-attachments/assets/600fb703-b4a3-4719-82f7-956424179925" />
  - Для отдельной логики можно поставить условия окончания фаз. Бывает полезно, когда игру нужно закончить ручным способом - с помощью оператора (прим. "Какой? Какая? Какое?") <img width="333" height="111" alt="image" src="https://github.com/user-attachments/assets/52a65c45-d698-48c4-a963-5c996d45a7a7" />
### Как создать квест?
1. **Файловая структура**
<img width="147" height="227" alt="image" src="https://github.com/user-attachments/assets/5717d21a-ac20-4f0e-bb82-8d5f629fb345" />

- Сперва папку для квеста: Features/Quests/[имя квеста]/
- Потом прочие компоненты:
  - Phrases - для фраз нарратора
  - Scripts - необходимые для работы квесты
  - Prefabs. Common - сопутствующие префабы, могут использоваться в других квестах. Quest - где лежит сам квест
  - *Art - если есть визуал
  - *Sounds - если есть звуки
3. Создать логику игры. Это имплементация IQuestLogic и создание сопутствующих скриптов.
- Не спеши реализовывать логику. Возможно, это уже было воссоздано до тебя. Уже сейчас есть скрипты, которые реализуют базовые механики
  - TriggerVisitor.cs - посетитель триггера. Нужно задать имя
  - TriggerWaiter.cs - ожидает посетителя. Нужен для работы с 3D посетителями
  - TriggerMagneticWaiter.cs - ожидает посетителя, притягивает его к себе при обнаружении, отталкивает при несходимости. Нужен для работы с UI посетителями
  - VisibilityAnimator.cs - класс, который прячет или показывает объекты. Собирает все компоненты из потомков, которые могут быть сокрыты.
  - ConcreteVisibilityChanger.cs - класс, который обращается к действующему на GameObject визАниматору. Просит его поменять конкретный объект
  - ZoneTriggerComponent.cs - возвращает на базу объект, который вышел из зоны. Подходит для отслеживания 3D объектов
  - ReturnToBaseComponent.cs - объект, которые может выйти из зоны. Это может быть интерактивный объект, который игрок может случайно швырнуть за горизонт
4. **Создать префаб квеста**.
5. Добавить QuestCore. Обычные компоненты подкрутся сразу.
<img width="496" height="115" alt="image" src="https://github.com/user-attachments/assets/35a3354f-aa3b-4a5f-a6ce-097128925443" />
- Настроить компоненты
  - Вставить фразы в нарратор
<img width="495" height="75" alt="image" src="https://github.com/user-attachments/assets/04c47e83-8325-42ad-a0d0-55ec8ffd6ef4" />

  - Настроить фазы, логику, визуальный контроллер (если нужно скрыть объекты в начале)
6. Создать квест, префабы для него
7. Добавить квест в квестовый скриптабл. При необходимости поменять порядок
<img width="481" height="145" alt="image" src="https://github.com/user-attachments/assets/3c184830-7b9e-45a2-ac1e-c2128ac4b2a5" />

## Сцена
### Динамический спавн 
Раньше на сцене было много мусорных объектов. Сейчас же все необходимое спавнится после запуска игры.
В результате SampleScene будет редко меняться. И будет меньше merge conflicts в будущем, когда где-то поменялись 2-3 параметра на сцене
<img width="501" height="825" alt="image" src="https://github.com/user-attachments/assets/5aa70a0e-9d86-4c83-a42d-12e70873b0b5" />

### HiderUI
При запуске будет черный экран. Это для того, чтобы оператор случайно не начал сессию, не выбрав профиль игрока.
<img width="733" height="435" alt="image" src="https://github.com/user-attachments/assets/8b85503c-4523-41b0-928a-477f464369e9" />

Чтобы работать дальше, нужно выбрать профиль и начать сессию. Панель оператора находится на **Display 2**.
<img width="759" height="489" alt="image" src="https://github.com/user-attachments/assets/67fc5d9e-3702-4683-be8c-a8f354eac6cc" />

---
## Сама разработка
### Ветки
Всегда, чтобы это ни было, нужно создавать ветку от dev. Название ветки будет зависеть от того, что делаешь:
- **feature/** - не влияет на работу систем, являтся контентом. Пример: квесты
- **core/** - корень игры, влияет на работу систем между собой. Пример: QuestManagementSystem
- **fix/** - фикс того, что уже было когда-то создано. Пример: фикс MeshVisual, который не прятал 3D объекты

Пока что допускается, что для работы фичи мы можем немного изменить ядро. Но об этом нужно сказать в коммите

### Коммиты
Коммиты должны быть информативные. Если информации много, стоит рассказать об изменениях в описании коммита
Частота коммитов по усмотрению. Лучше делать коммиты по логическому делению: добавил файлы - коммит; сделал базу - коммит; сделал визуал - коммит. Пока что допускаются большие коммиты

### Слияние
Как ветка готова, создаете Pull Request, тэгаете меня в гитхабе как ревьюера, или в соцсетях. Я проверяю код. В основном, буду проверять принципы SOLID и адекватность кода. Например, говнокод в логике квеста еще норм, а вот в системе спавнера тайла уже не очень.

Можно запрашивать ревьюинг у бота/генаи/нейронки/ллмки. Промпт примерно такой: вот код в файле ".txt", проверь на SOLID.

**Важно!** Бот может прислать слишком сложную архитектуру, когда усложнять особо не нужно. Это значит, что не нужно полностью внедрять его решение в код. Прогоните решение пару раз через себя, обмыслите и взвесьте "за" и "против", а потом уже вводите то, что нужно. 

### Слежение за прогрессом
- YouGile. Для отслеживания выполнения. [Ссылка](https://ru.yougile.com/team/00f11155e087/%D0%9A%D0%B0%D1%80%D0%B4%D0%B8%D0%BE%D1%86%D0%B5%D0%BD%D1%82%D1%80-__dash__-%D1%80%D0%B5%D0%B0%D0%B1%D0%B8%D0%BB%D0%B8%D1%82%D0%B0%D1%86%D0%B8%D1%8F/30.07__dash__15.08-__dash__-%D0%A2%D0%97%2C-%D0%9E%D1%86%D0%B5%D0%BD%D0%BA%D0%B0%2C-%D0%9F%D0%BB%D0%B0%D0%BD#KAR-39)
**Важно!** Когда выполняете задачу, добавляйте туда секундомер. Это мелочь, но от нее зависит бюджет разработки! Наша работа измеряется в человекочасах. Чем точнее знаем время выполнение, тем лучше. 
- GoogleSheets. Для ориентира и отчетности третьим лицам. (https://docs.google.com/spreadsheets/d/1CdR984VcI-gPY_HR5BZXwnn7VUbO30tiTKw3gtVqaC0/edit?gid=0#gid=0)[Ссылка]
